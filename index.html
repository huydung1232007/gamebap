<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Chiến Binh Xuyên 1 Màn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#111;height:100vh;display:flex;justify-content:center;align-items:center;font-family:sans-serif;color:#fff;-webkit-user-select:none;user-select:none;touch-action:none}
    canvas{background:transparent;}
    /* pad cảm ứng */
    #pad{position:absolute;bottom:40px;left:50%;transform:translateX(-50%);display:flex;gap:14px}
    .btn{width:72px;height:72px;background:rgba(51,51,51,.35);border-radius:12px;display:flex;justify-content:center;align-items:center;font-size:32px;color:#fff}
    @media(min-width:900px){#pad{display:none}}
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <!-- touch pad -->
  <div id="pad">
    <div class="btn" id="left">←</div>
    <div class="btn" id="fire">⚔</div>
    <div class="btn" id="right">→</div>
  </div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W,H; resize(); window.addEventListener('resize',resize);
function resize(){W=canvas.width=innerWidth; H=canvas.height=innerHeight}

// assets
const heroImg=new Image(); heroImg.src='https://archive.org/download/bb_20250607_202506/bb.png';
const monsterImg=new Image(); monsterImg.src='https://archive.org/download/hh_20250607/hh.png';

// hero
const hero={x:W/2,y:H-120,w:60,h:90,speed:250,hp:3,name:'Ngô Thùy Ngân'};

class Monster{
  constructor(){
    this.size=60;
    this.x=hero.x; // start above hero then move sideways
    this.y=120;
    this.vx=180;
    this.hpMax=50;
    this.hp=this.hpMax;
  }
  update(dt){
    this.x+=this.vx*dt;
    if(this.x< this.size/2 || this.x>W-this.size/2){
      this.vx*=-1;
      this.y+=30;
    }
  }
  draw(){
    if(monsterImg.complete) ctx.drawImage(monsterImg,this.x-this.size/2,this.y-this.size/2,this.size,this.size);
    else {ctx.fillStyle='#c33';ctx.fillRect(this.x-this.size/2,this.y-this.size/2,this.size,this.size);}
    // hp bar
    const barW=this.size, barH=6;
    ctx.fillStyle='#555'; ctx.fillRect(this.x-barW/2,this.y-this.size/2-12,barW,barH);
    ctx.fillStyle='#e44'; ctx.fillRect(this.x-barW/2,this.y-this.size/2-12,barW*this.hp/this.hpMax,barH);
  }
}
let monster=new Monster();

class Bullet{
  constructor(x,y){this.x=x;this.y=y;this.speed=500;this.size=24;this.active=true;}
  update(dt){this.y-=this.speed*dt; if(this.y<-50) this.active=false;}
  draw(){ctx.font=this.size+'px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle='#ff5b9f';ctx.fillText('❤',this.x,this.y);}  
}

// heart explosion particles
class Particle{
  constructor(x,y){
    this.x=x;this.y=y;
    const angle=Math.random()*Math.PI*2;
    const speed=150+Math.random()*150;
    this.vx=Math.cos(angle)*speed;
    this.vy=Math.sin(angle)*speed;
    this.life=0.8; // seconds
    this.size=12+Math.random()*8;
  }
  update(dt){this.life-=dt;this.x+=this.vx*dt;this.y+=this.vy*dt;this.vy+=150*dt;} // gravity
  draw(){ctx.globalAlpha=Math.max(this.life/0.8,0);ctx.font=this.size+'px serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle='#ff5b9f';ctx.fillText('❤',this.x,this.y);ctx.globalAlpha=1;}
}

const bullets=[]; const particles=[];
let lastShot=0;

// input
const keys={};
addEventListener('keydown',e=>{keys[e.key]=true;});
addEventListener('keyup',e=>{keys[e.key]=false;});
// touch pad
left.ontouchstart=()=>keys['ArrowLeft']=true;
left.ontouchend =()=>keys['ArrowLeft']=false;
right.ontouchstart=()=>keys['ArrowRight']=true;
right.ontouchend =()=>keys['ArrowRight']=false;
fire.ontouchstart=()=>shoot();

function shoot(){const now=performance.now(); if(now-lastShot<330) return; bullets.push(new Bullet(hero.x,hero.y-hero.h/2)); lastShot=now;}
addEventListener('keydown',e=>{if(e.code==='Space') shoot();});

let prev=performance.now();
requestAnimationFrame(loop);
function loop(now){const dt=(now-prev)/1000; prev=now; update(dt); draw(); requestAnimationFrame(loop);} 

function update(dt){
  // hero move
  if(keys['ArrowLeft']) hero.x-=hero.speed*dt;
  if(keys['ArrowRight']) hero.x+=hero.speed*dt;
  hero.x=Math.max(hero.w/2,Math.min(W-hero.w/2,hero.x));

  // bullets
  bullets.forEach(b=>b.update(dt));
  bullets.filter(b=>b.active);

  // monster
  monster.update(dt);

  // collision bullet-monster
  bullets.forEach(b=>{
    if(b.active && Math.abs(b.x-monster.x)<monster.size/2 && Math.abs(b.y-monster.y)<monster.size/2){
      b.active=false; monster.hp-=5;
      createExplosion(b.x,b.y);
      if(monster.hp<=0){alert('Bạn thắng!'); location.reload();}
    }
  });

  // collision monster-hero
  if(Math.abs(monster.x-hero.x)<(monster.size+hero.w)/2 && Math.abs(monster.y-hero.y)<(monster.size+hero.h)/2){
    alert('Bạn đã thua! Quái đã chạm tới bạn.'); location.reload();
  }

  // clean arrays
  for(let i=bullets.length-1;i>=0;i--) if(!bullets[i].active) bullets.splice(i,1);

  // particles
  particles.forEach(p=>p.update(dt));
  for(let i=particles.length-1;i>=0;i--) if(particles[i].life<=0) particles.splice(i,1);
}

function createExplosion(x,y){
  for(let i=0;i<18;i++) particles.push(new Particle(x,y));
}

function draw(){ctx.clearRect(0,0,W,H);
  // hero
  if(heroImg.complete) ctx.drawImage(heroImg,hero.x-hero.w/2,hero.y-hero.h/2,hero.w,hero.h);
  else {ctx.fillStyle='#f9c'; ctx.fillRect(hero.x-hero.w/2,hero.y-hero.h/2,hero.w,hero.h);}  
  // hero name & hp bar
  ctx.textAlign='center'; ctx.font='16px sans-serif'; ctx.fillStyle='#fff'; ctx.fillText(hero.name,hero.x,hero.y-hero.h/2-20);
  ctx.fillStyle='#0c0'; ctx.fillRect(hero.x-hero.w/2,hero.y-hero.h/2-12,hero.w*(hero.hp/3),6);
  ctx.strokeStyle='#555'; ctx.strokeRect(hero.x-hero.w/2,hero.y-hero.h/2-12,hero.w,6);

  // monster
  monster.draw();

  // bullets
  bullets.forEach(b=>b.draw());
  // particles
  particles.forEach(p=>p.draw());
}
</script>
</body>
</html>
